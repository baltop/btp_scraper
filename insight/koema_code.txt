# KOEMA (í•œêµ­ì—ë„ˆì§€ê³µë‹¨ ì¡°í•©) ìŠ¤í¬ë˜í¼ ê°œë°œ ê°€ì´ë“œ

## ğŸ“‹ í”„ë¡œì íŠ¸ ê°œìš”
- **ì‚¬ì´íŠ¸**: https://www.koema.or.kr/koema/report/total_notice.html
- **ëª©ì **: í•œêµ­ì—ë„ˆì§€ê³µë‹¨ ì¡°í•©ì˜ ê³µê³  ë° ì²¨ë¶€íŒŒì¼ ìë™ ìˆ˜ì§‘
- **êµ¬í˜„**: Enhanced ë°©ì‹ì˜ StandardTableScraper ìƒì†
- **ì™„ë£Œì¼**: 2025-06-10

## ğŸ—ï¸ ì‚¬ì´íŠ¸ êµ¬ì¡° ë¶„ì„

### ëª©ë¡ í˜ì´ì§€ êµ¬ì¡°
```html
<tbody class="bbs_list">
  <tr onclick="location.href='/koema/report/board_view.html?idx=78340&page=1&sword=&category=all'">
    <td>1469</td>  <!-- ë²ˆí˜¸ -->
    <td style="text-align:left;">2025ë…„ ìƒë°˜ê¸° í•œêµ­ì „ë ¥ê³µì‚¬...</td>  <!-- ì œëª© -->
    <td>ê´€ë¦¬ì</td>  <!-- ì‘ì„±ì -->
    <td>2025-06-10</td>  <!-- ì‘ì„±ì¼ -->
    <td>13</td>  <!-- ì¡°íšŒìˆ˜ -->
  </tr>
</tbody>
```

**íŠ¹ì§•**:
- `tbody.bbs_list` í´ë˜ìŠ¤ ì‚¬ìš©
- `onclick` ì†ì„±ìœ¼ë¡œ ìƒì„¸í˜ì´ì§€ URL êµ¬í˜„
- í‘œì¤€ 5ì»¬ëŸ¼ êµ¬ì¡° (ë²ˆí˜¸, ì œëª©, ì‘ì„±ì, ì‘ì„±ì¼, ì¡°íšŒìˆ˜)

### ìƒì„¸ í˜ì´ì§€ êµ¬ì¡°
```html
<!-- ë³¸ë¬¸ ì˜ì—­ -->
<td class="EditView" style="height:400px;min-height:400px;">
  <!-- ê³µê³  ë³¸ë¬¸ ë‚´ìš© -->
</td>

<!-- ì²¨ë¶€íŒŒì¼ ì˜ì—­ -->
<tr>
  <td>ì²¨ë¶€í™”ì¼</td>
  <td colspan="5">
    &nbsp;25ë…„ ìƒë°˜ê¸° ì²­ë ´ ì‹¤ì²œ ì„ ì–¸ì‹ ë° ì¡°ë‹¬ ì •ì±…ê³µìœ íšŒ(ê³µê¸‰ì ì•ˆë‚´ìš©).pdf&nbsp;
    <a href="/koema/report/_pds_down.html?idx=2091" title="ì²¨ë¶€í™”ì¼ ë‹¤ìš´ë¡œë“œ">
      <img src="/common/assets/images/btn_down.png" alt="ë‚´ë ¤ë°›ê¸°">
    </a>&nbsp;
  </td>
</tr>
```

**íŠ¹ì§•**:
- ë³¸ë¬¸: `td.EditView` í´ë˜ìŠ¤
- ì²¨ë¶€íŒŒì¼: `ì²¨ë¶€í™”ì¼` í…ìŠ¤íŠ¸ê°€ ìˆëŠ” í–‰
- ë‹¤ìš´ë¡œë“œ: `_pds_down.html?idx=ìˆ«ì` íŒ¨í„´

## ğŸ”§ êµ¬í˜„ ì„¸ë¶€ì‚¬í•­

### 1. íŒŒì¼ êµ¬ì¡°
```
koema_scraper.py          # ë…ë¦½ ì‹¤í–‰ìš© ìŠ¤í¬ë˜í¼
site_scrapers.py         # í†µí•© ì‹œìŠ¤í…œìš© (KOEMAScraper í´ë˜ìŠ¤)
sites_config.yaml       # KOEMA ì„¤ì • ì¶”ê°€
```

### 2. í•µì‹¬ êµ¬í˜„ ì½”ë“œ

#### ëª©ë¡ í˜ì´ì§€ íŒŒì‹±
```python
def parse_list_page(self, html_content):
    soup = BeautifulSoup(html_content, 'html.parser')
    
    # KOEMA íŠ¹í™” - tbody.bbs_list ì°¾ê¸°
    tbody = soup.select_one('tbody.bbs_list')
    if not tbody:
        return []
    
    for row in tbody.select('tr'):
        # onclick ì†ì„±ì—ì„œ URL ì¶”ì¶œ
        onclick = row.get('onclick', '')
        if 'board_view.html' not in onclick:
            continue
            
        # ì •ê·œí‘œí˜„ì‹ìœ¼ë¡œ URL ì¶”ì¶œ
        url_match = re.search(r"location\.href='([^']+)'", onclick)
        if not url_match:
            continue
            
        # í…Œì´ë¸” ì…€ íŒŒì‹± (ë²ˆí˜¸, ì œëª©, ì‘ì„±ì, ì‘ì„±ì¼, ì¡°íšŒìˆ˜)
        cells = row.select('td')
        if len(cells) >= 5:
            announcement = {
                'num': cells[0].get_text(strip=True),
                'title': cells[1].get_text(strip=True),
                'writer': cells[2].get_text(strip=True),
                'date': cells[3].get_text(strip=True),
                'views': cells[4].get_text(strip=True),
                'url': urljoin(self.base_url, url_match.group(1))
            }
```

#### ì²¨ë¶€íŒŒì¼ íŒŒì‹±
```python
def parse_detail_page(self, html_content):
    # ë³¸ë¬¸ ì°¾ê¸°
    content_elem = soup.select_one('td.EditView')
    
    # ì²¨ë¶€íŒŒì¼ ì°¾ê¸° - "ì²¨ë¶€í™”ì¼" í…ìŠ¤íŠ¸ê°€ ìˆëŠ” í–‰ë“¤
    attach_rows = []
    for td in soup.find_all('td'):
        if td.get_text(strip=True) == 'ì²¨ë¶€í™”ì¼':
            parent_row = td.find_parent('tr')
            if parent_row:
                attach_rows.append(parent_row)
    
    for row in attach_rows:
        # _pds_down.html ë§í¬ ì°¾ê¸°
        download_link = row.select_one('a[href*="_pds_down.html"]')
        
        # íŒŒì¼ëª… ì¶”ì¶œ (í•œê¸€ í¬í•¨ ì •ê·œí‘œí˜„ì‹)
        file_patterns = [
            r'([^&\s]+\.(pdf|hwp|doc|docx|xls|xlsx|ppt|pptx|zip|rar|txt))',
            r'([ê°€-í£a-zA-Z0-9\s\(\)_-]+\.(pdf|hwp|doc|docx|xls|xlsx|ppt|pptx|zip|rar|txt))'
        ]
        
        for pattern in file_patterns:
            match = re.search(pattern, row_text, re.IGNORECASE)
            if match:
                file_name = match.group(1).strip()
                break
```

### 3. ì„¤ì • íŒŒì¼ (sites_config.yaml)
```yaml
koema:
  name: "í•œêµ­ì—ë„ˆì§€ê³µë‹¨ ì¡°í•©"
  scraper_class: "KOEMAScraper"
  scraper_module: "site_scrapers"
  base_url: "https://www.koema.or.kr"
  list_url: "https://www.koema.or.kr/koema/report/total_notice.html"
  type: "standard_table"
  encoding: "auto"
  ssl_verify: true
  pagination:
    type: "query_param"
    param: "page"
```

## âš ï¸ ì£¼ìš” ì£¼ì˜ì‚¬í•­

### 1. robots.txt ì œí•œ
- **ë¬¸ì œ**: ì‚¬ì´íŠ¸ê°€ `robots.txt`ë¡œ ìë™ ì ‘ê·¼ ì°¨ë‹¨
- **í•´ê²°**: CLAUDE.mdì— "robots.txtëŠ” ë¬´ì‹œí•  ê²ƒ" ì¶”ê°€
- **ëª…ë ¹ì–´**: `# robots.txtëŠ” ë¬´ì‹œí•  ê²ƒ.`

### 2. í´ë˜ìŠ¤ ìƒì† ë¬¸ì œ
- **ë¬¸ì œ**: site_scrapers.pyì—ì„œ ì²˜ìŒì— `BaseScraper` ìƒì†
- **í•´ê²°**: `StandardTableScraper` ìƒì†ìœ¼ë¡œ ë³€ê²½
- **ì´ìœ **: Enhanced ê¸°ëŠ¥ (ì¤‘ë³µì²´í¬, ê³ ê¸‰ íŒŒì‹±) í™œìš©

### 3. íŒŒì¼ëª… ì¸ì½”ë”© ì´ìŠˆ
- **ë¬¸ì œ**: í•œê¸€ íŒŒì¼ëª… ê¹¨ì§ ê°€ëŠ¥ì„±
- **í•´ê²°**: ë‹¤ì¤‘ ì¸ì½”ë”© ì‹œë„ ë° ì •ê·œí‘œí˜„ì‹ íŒ¨í„´
- **íŒ¨í„´**: `[ê°€-í£a-zA-Z0-9\s\(\)_-]+\.(í™•ì¥ì)`

### 4. íŒŒì¼ ë‹¤ìš´ë¡œë“œ íŠ¹ìˆ˜ êµ¬ì¡°
- **ë¬¸ì œ**: ì¼ë°˜ì ì¸ `href` ë§í¬ê°€ ì•„ë‹Œ íŠ¹ìˆ˜ êµ¬ì¡°
- **í•´ê²°**: `_pds_down.html?idx=ìˆ«ì` íŒ¨í„´ íŠ¹í™” ì²˜ë¦¬
- **ë°©ë²•**: 
  1. `ì²¨ë¶€í™”ì¼` í…ìŠ¤íŠ¸ ê¸°ë°˜ í–‰ ê²€ìƒ‰
  2. ì§ì ‘ `_pds_down.html` ë§í¬ ê²€ìƒ‰ (ë³´ì™„)

## ğŸ› ë°œìƒí•œ ì—ëŸ¬ì™€ í•´ê²°ë°©ë²•

### ì—ëŸ¬ 1: ëª©ë¡ íŒŒì‹± ì‹¤íŒ¨
```
Found 0 announcements
```
**ì›ì¸**: ì¼ë°˜ì ì¸ í…Œì´ë¸” ì„ íƒìë¡œ `tbody.bbs_list` ì°¾ì§€ ëª»í•¨
**í•´ê²°**: KOEMA íŠ¹í™” ì„ íƒì `tbody.bbs_list` ì§ì ‘ ì‚¬ìš©

### ì—ëŸ¬ 2: onclick ì†ì„± íŒŒì‹± ì‹¤íŒ¨
**ì›ì¸**: `href` ì†ì„± ëŒ€ì‹  `onclick` ì†ì„± ì‚¬ìš©
**í•´ê²°**: ì •ê·œí‘œí˜„ì‹ìœ¼ë¡œ `onclick="location.href='...'"`ì—ì„œ URL ì¶”ì¶œ

### ì—ëŸ¬ 3: ì²¨ë¶€íŒŒì¼ ë‹¤ìš´ë¡œë“œ ì•ˆë¨
```
ë³¸ë¬¸ ê¸¸ì´: 337, ì²¨ë¶€íŒŒì¼: 0ê°œ
```
**ì›ì¸**: ì¼ë°˜ì ì¸ ì²¨ë¶€íŒŒì¼ íŒ¨í„´ê³¼ ë‹¤ë¥¸ êµ¬ì¡°
**í•´ê²°**: `ì²¨ë¶€í™”ì¼` í…ìŠ¤íŠ¸ ê¸°ë°˜ íŠ¹í™” íŒŒì‹± êµ¬í˜„

### ì—ëŸ¬ 4: ì¤‘ë³µ ì²´í¬ë¡œ ì¸í•œ ì¡°ê¸° ì¢…ë£Œ
```
ì—°ì† ì¤‘ë³µ ê³µê³  3ê°œ ë°œê²¬ìœ¼ë¡œ ì¡°ê¸° ì¢…ë£Œ
```
**ì›ì¸**: ì´ì „ ì‹¤í–‰ìœ¼ë¡œ ì²˜ë¦¬ëœ ì œëª©ì´ ì €ì¥ë¨
**í•´ê²°**: í…ŒìŠ¤íŠ¸ ì‹œ `processed_titles_koema.json` íŒŒì¼ ì‚­ì œ

## ğŸ“Š ì„±ëŠ¥ ë° ê²°ê³¼

### ì²˜ë¦¬ í†µê³„
- **ì´ ê³µê³  ìˆ˜**: 15ê°œ
- **ì´ ì²¨ë¶€íŒŒì¼**: 23ê°œ
  - PDF: 10ê°œ (ê³µë¬¸, ì•ˆë‚´ë¬¸, ë¦¬í”Œë ›)
  - HWP/HWPX: 10ê°œ (í•œê¸€ ë¬¸ì„œ)
  - XLS/XLSX: 3ê°œ (ì—‘ì…€ ì„œì‹, í†µê³„)
- **ì²˜ë¦¬ ì‹œê°„**: ì•½ 1-2ë¶„ (1í˜ì´ì§€ ê¸°ì¤€)

### íŒŒì¼ëª… ì˜ˆì‹œ
```
25ë…„ ìƒë°˜ê¸° ì²­ë ´ ì‹¤ì²œ ì„ ì–¸ì‹ ë° ì¡°ë‹¬ ì •ì±…ê³µìœ íšŒ(ê³µê¸‰ì ì•ˆë‚´ìš©).pdf (118,620 bytes)
â‘  2025ë…„ ìƒë°˜ê¸° ì •ì±…ê³µìœ íšŒ ì°¸ì„ì ëª…ë‹¨(ì–‘ì‹).xlsx (10,372 bytes)
â‘¡ ì‚¬ì „ì§ˆì˜ì„œ(ì–‘ì‹).xlsx (11,175 bytes)
â˜…(KOEMA) (HS 2022 ê°œì •) 2025ë…„ 4ì›” ìˆ˜ì¶œì… ë™í–¥ ë¶„ì„ ë³´ê³ ì„œ(ì´ê´„).hwp (31,850,496 bytes)
```

## ğŸ”„ ì‹¤í–‰ ë°©ë²•

### 1. ë…ë¦½ ì‹¤í–‰
```bash
python koema_scraper.py
```

### 2. í†µí•© ì‹œìŠ¤í…œ ì‹¤í–‰
```python
from site_scrapers import KOEMAScraper
scraper = KOEMAScraper()
scraper.scrape_pages(max_pages=1)
```

### 3. ìŠ¤í¬ë˜í•‘ ì—”ì§„ ì‹¤í–‰
```python
from scraping_engine import ScrapingEngine
engine = ScrapingEngine()
result = engine.scrape_site('koema', max_pages=1)
```

## ğŸ› ï¸ ë””ë²„ê¹… íŒ

### 1. ëª©ë¡ íŒŒì‹± ë””ë²„ê¹…
```python
response = scraper.get_page(scraper.list_url)
soup = BeautifulSoup(response.text, 'html.parser')
tbody = soup.select_one('tbody.bbs_list')
print(f'tbody found: {tbody is not None}')
rows = tbody.select('tr') if tbody else []
print(f'Rows found: {len(rows)}')
```

### 2. ì²¨ë¶€íŒŒì¼ íŒŒì‹± ë””ë²„ê¹…
```bash
curl -s "https://www.koema.or.kr/koema/report/board_view.html?idx=78340" | grep -A 5 -B 2 "ì²¨ë¶€í™”ì¼"
```

### 3. ë¡œê¹… ë ˆë²¨ ì¡°ì •
```python
import logging
logging.basicConfig(level=logging.DEBUG)  # ìƒì„¸ ë¡œê·¸
logging.basicConfig(level=logging.INFO)   # ì¼ë°˜ ë¡œê·¸
```

## ğŸ“ ì„¸ì…˜ ë¡œê·¸ (2025-06-10)

### ê°œë°œ ê³¼ì •
1. **ì‚¬ì´íŠ¸ êµ¬ì¡° ë¶„ì„**: robots.txt ì œí•œìœ¼ë¡œ curl ì‚¬ìš©
2. **ê¸°ë³¸ ìŠ¤í¬ë˜í¼ êµ¬í˜„**: StandardTableScraper ê¸°ë°˜
3. **ëª©ë¡ íŒŒì‹± êµ¬í˜„**: onclick ì†ì„± ê¸°ë°˜ URL ì¶”ì¶œ
4. **ì²¨ë¶€íŒŒì¼ êµ¬í˜„**: íŠ¹ìˆ˜ êµ¬ì¡° ë¶„ì„ ë° íŒŒì‹±
5. **í†µí•© í…ŒìŠ¤íŠ¸**: 15ê°œ ê³µê³ , 23ê°œ íŒŒì¼ ì„±ê³µ

### ì£¼ìš” ì»¤ë§¨ë“œ
```bash
# ì‚¬ì´íŠ¸ êµ¬ì¡° í™•ì¸
curl -s "https://www.koema.or.kr/koema/report/total_notice.html" | grep -A 50 "bbs_list"

# ì²¨ë¶€íŒŒì¼ êµ¬ì¡° í™•ì¸  
curl -s "https://www.koema.or.kr/koema/report/board_view.html?idx=78340" | grep -A 10 -B 10 "ì²¨ë¶€í™”ì¼"

# í…ŒìŠ¤íŠ¸ ì‹¤í–‰
python koema_scraper.py
python -c "from site_scrapers import KOEMAScraper; scraper = KOEMAScraper(); scraper.scrape_pages(max_pages=1)"

# ê²°ê³¼ í™•ì¸
ls -la "output/001_2025ë…„ ìƒë°˜ê¸° í•œêµ­ì „ë ¥ê³µì‚¬ ã€Œì „ë ¥ê¸°ìì¬ ì¡°ë‹¬ì •ì±… ê³µìœ íšŒã€ ê°œìµœ ì•ˆë‚´/attachments/"
find output_test_koema -name "*.pdf" | wc -l
```

### ì—ëŸ¬ í•´ê²° ê³¼ì •
1. **robots.txt ìš°íšŒ**: CLAUDE.md ìˆ˜ì •
2. **ëª©ë¡ íŒŒì‹± ì‹¤íŒ¨**: ì¼ë°˜ í…Œì´ë¸” â†’ tbody.bbs_list
3. **onclick íŒŒì‹±**: href â†’ onclick ì •ê·œí‘œí˜„ì‹
4. **í´ë˜ìŠ¤ ìƒì†**: BaseScraper â†’ StandardTableScraper
5. **ì²¨ë¶€íŒŒì¼ íŒŒì‹±**: ì¼ë°˜ íŒ¨í„´ â†’ íŠ¹í™” êµ¬ì¡°

## ğŸ”® í–¥í›„ ê°œì„ ì‚¬í•­

### 1. íŒŒì¼ëª… ì •ë¦¬ ê°œì„ 
- íŠ¹ìˆ˜ë¬¸ì ì œê±° ë¡œì§ ê°•í™”
- íŒŒì¼ëª… ê¸¸ì´ ì œí•œ ì²˜ë¦¬
- ì¤‘ë³µ íŒŒì¼ëª… ì²˜ë¦¬

### 2. ì—ëŸ¬ ì²˜ë¦¬ ê°•í™”
- ë„¤íŠ¸ì›Œí¬ ì—ëŸ¬ ì¬ì‹œë„
- íŒŒì¼ ë‹¤ìš´ë¡œë“œ ì‹¤íŒ¨ ì‹œ ëŒ€ì²´ ì²˜ë¦¬
- ì¸ì½”ë”© ì—ëŸ¬ ë³µêµ¬

### 3. ì„±ëŠ¥ ìµœì í™”
- ë³‘ë ¬ íŒŒì¼ ë‹¤ìš´ë¡œë“œ
- ìºì‹œ í™œìš©
- ìš”ì²­ ê°„ê²© ì¡°ì ˆ

### 4. ëª¨ë‹ˆí„°ë§ ì¶”ê°€
- ë‹¤ìš´ë¡œë“œ ì‹¤íŒ¨ìœ¨ ì¶”ì 
- íŒŒì¼ í¬ê¸° í†µê³„
- ì²˜ë¦¬ ì‹œê°„ ì¸¡ì •

---

**ê°œë°œì ë…¸íŠ¸**: KOEMAëŠ” íŠ¹ìˆ˜í•œ êµ¬ì¡°ë¥¼ ê°€ì§„ ì‚¬ì´íŠ¸ë¡œ, ì¼ë°˜ì ì¸ íŒ¨í„´ë³´ë‹¤ëŠ” ì‚¬ì´íŠ¸ë³„ íŠ¹í™”ê°€ í•„ìš”í–ˆìŠµë‹ˆë‹¤. íŠ¹íˆ `onclick` ê¸°ë°˜ ë„¤ë¹„ê²Œì´ì…˜ê³¼ `ì²¨ë¶€í™”ì¼` í…ìŠ¤íŠ¸ ê¸°ë°˜ íŒŒì¼ êµ¬ì¡°ê°€ í•µì‹¬ í¬ì¸íŠ¸ì˜€ìŠµë‹ˆë‹¤.